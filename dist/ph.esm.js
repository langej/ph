class c extends HTMLElement{#s=[];log(...s){let r=this.id?` #${this.id}`:"",o=this.getAttribute("name")?` :${this.getAttribute("name")}`:"";console.log(`[${this.tagName}${o}${r}]`,...s)}mount(){}unmount(){}connectedCallback(){this.mount()}disconnectedCallback(){this.unmount(),this.#s?.forEach((s)=>s()),this.#s=[]}on(s,r){return this.addEventListener(s,r)}getHost(){let s=this.getRootNode();return s.host??s}emit(s,r){let o=!r?new Event(s,{composed:!0}):new CustomEvent(s,{detail:r,composed:!0});this.dispatchEvent(o)}onRemove(s){this.#s.push(s)}}var Ss=Symbol.for("preact-signals");function Z(){if(!(_>1)){var s,r=!1;while(X!==void 0){var o=X;X=void 0,U++;while(o!==void 0){var t=o.o;if(o.o=void 0,o.f&=-3,!(8&o.f)&&Ts(o))try{o.c()}catch(n){if(!r)s=n,r=!0}o=t}}if(U=0,_--,r)throw s}else _--}var g=void 0;function ps(s){var r=g;g=void 0;try{return s()}finally{g=r}}var X=void 0,_=0,U=0,q=0;function cs(s){if(g!==void 0){var r=s.n;if(r===void 0||r.t!==g){if(r={i:0,S:s,p:g.s,n:void 0,t:g,e:void 0,x:void 0,r},g.s!==void 0)g.s.n=r;if(g.s=r,s.n=r,32&g.f)s.S(r);return r}else if(r.i===-1){if(r.i=0,r.n!==void 0){if(r.n.p=r.p,r.p!==void 0)r.p.n=r.n;r.p=g.s,r.n=void 0,g.s.n=r,g.s=r}return r}}}function C(s,r){this.v=s,this.i=0,this.n=void 0,this.t=void 0,this.W=r==null?void 0:r.watched,this.Z=r==null?void 0:r.unwatched,this.name=r==null?void 0:r.name}C.prototype.brand=Ss;C.prototype.h=function(){return!0};C.prototype.S=function(s){var r=this,o=this.t;if(o!==s&&s.e===void 0)if(s.x=o,this.t=s,o!==void 0)o.e=s;else ps(function(){var t;(t=r.W)==null||t.call(r)})};C.prototype.U=function(s){var r=this;if(this.t!==void 0){var{e:o,x:t}=s;if(o!==void 0)o.x=t,s.e=void 0;if(t!==void 0)t.e=o,s.x=void 0;if(s===this.t){if(this.t=t,t===void 0)ps(function(){var n;(n=r.Z)==null||n.call(r)})}}};C.prototype.subscribe=function(s){var r=this;return h(function(){var o=r.value,t=g;g=void 0;try{s(o)}finally{g=t}},{name:"sub"})};C.prototype.valueOf=function(){return this.value};C.prototype.toString=function(){return this.value+""};C.prototype.toJSON=function(){return this.value};C.prototype.peek=function(){var s=g;g=void 0;try{return this.value}finally{g=s}};Object.defineProperty(C.prototype,"value",{get:function(){var s=cs(this);if(s!==void 0)s.i=this.i;return this.v},set:function(s){if(s!==this.v){if(U>100)throw Error("Cycle detected");this.v=s,this.i++,q++,_++;try{for(var r=this.t;r!==void 0;r=r.x)r.t.N()}finally{Z()}}}});function k(s,r){return new C(s,r)}function Ts(s){for(var r=s.s;r!==void 0;r=r.n)if(r.S.i!==r.i||!r.S.h()||r.S.i!==r.i)return!0;return!1}function ys(s){for(var r=s.s;r!==void 0;r=r.n){var o=r.S.n;if(o!==void 0)r.r=o;if(r.S.n=r,r.i=-1,r.n===void 0){s.s=r;break}}}function vs(s){var r=s.s,o=void 0;while(r!==void 0){var t=r.p;if(r.i===-1){if(r.S.U(r),t!==void 0)t.n=r.n;if(r.n!==void 0)r.n.p=t}else o=r;if(r.S.n=r.r,r.r!==void 0)r.r=void 0;r=t}s.s=o}function W(s,r){C.call(this,void 0),this.x=s,this.s=void 0,this.g=q-1,this.f=4,this.W=r==null?void 0:r.watched,this.Z=r==null?void 0:r.unwatched,this.name=r==null?void 0:r.name}W.prototype=new C;W.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32)return!0;if(this.f&=-5,this.g===q)return!0;if(this.g=q,this.f|=1,this.i>0&&!Ts(this))return this.f&=-2,!0;var s=g;try{ys(this),g=this;var r=this.x();if(16&this.f||this.v!==r||this.i===0)this.v=r,this.f&=-17,this.i++}catch(o){this.v=o,this.f|=16,this.i++}return g=s,vs(this),this.f&=-2,!0};W.prototype.S=function(s){if(this.t===void 0){this.f|=36;for(var r=this.s;r!==void 0;r=r.n)r.S.S(r)}C.prototype.S.call(this,s)};W.prototype.U=function(s){if(this.t!==void 0){if(C.prototype.U.call(this,s),this.t===void 0){this.f&=-33;for(var r=this.s;r!==void 0;r=r.n)r.S.U(r)}}};W.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var s=this.t;s!==void 0;s=s.x)s.t.N()}};Object.defineProperty(W.prototype,"value",{get:function(){if(1&this.f)throw Error("Cycle detected");var s=cs(this);if(this.h(),s!==void 0)s.i=this.i;if(16&this.f)throw this.v;return this.v}});function As(s,r){return new W(s,r)}function bs(s){var r=s.u;if(s.u=void 0,typeof r=="function"){_++;var o=g;g=void 0;try{r()}catch(t){throw s.f&=-2,s.f|=8,R(s),t}finally{g=o,Z()}}}function R(s){for(var r=s.s;r!==void 0;r=r.n)r.S.U(r);s.x=void 0,s.s=void 0,bs(s)}function xs(s){if(g!==this)throw Error("Out-of-order effect");if(vs(this),g=s,this.f&=-2,8&this.f)R(this);Z()}function j(s,r){this.x=s,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32,this.name=r==null?void 0:r.name}j.prototype.c=function(){var s=this.S();try{if(8&this.f)return;if(this.x===void 0)return;var r=this.x();if(typeof r=="function")this.u=r}finally{s()}};j.prototype.S=function(){if(1&this.f)throw Error("Cycle detected");this.f|=1,this.f&=-9,bs(this),ys(this),_++;var s=g;return g=this,xs.bind(this,s)};j.prototype.N=function(){if(!(2&this.f))this.f|=2,this.o=X,X=this};j.prototype.d=function(){if(this.f|=8,!(1&this.f))R(this)};j.prototype.dispose=function(){this.d()};function h(s,r){var o=new j(s,r);try{o.c()}catch(n){throw o.d(),n}var t=o.d.bind(o);return t[Symbol.dispose]=t,t}var Os=(s,r)=>s.replace(/{{[^{}]*}}/g,(o)=>r(o.replace(/[{}]/g,""))),ms=document.createTreeWalker.bind(document),d=(s,r)=>!customElements.get(s)&&customElements.define(s,r),L=(s)=>s.replace(/-[a-z]/g,(r)=>r[1].toUpperCase()),J=(s,r)=>{return Os(s,(o)=>{let t=o.replace(/[{}]/g," ");if(r)t=r(t);return`<ph-slot value="${t}"></ph-slot>`})},y=(s,r)=>{return Function("context","computed",`with(context){return computed(() => ${r})}`)(s,As)},E=(s,r,o="")=>{let t=r??"",n=r?.includes("await");return Function("context",`return ${n?"async":""} function(${o}){with (context) {${t}}}`)(s)},B=(s)=>{return ms(s,NodeFilter.SHOW_ELEMENT,(r)=>r.tagName!=="TEMPLATE"?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT)},G=(s,r)=>{return ms(s,NodeFilter.SHOW_ELEMENT,r)};var Cs=({value:s,context:r})=>{try{return E(r,`return ${s}`)()}catch(o){console.error(o)}},Y=(s)=>{let r=s.getHost()?.[u]??document[u],o=s.getAttribute("name"),t=s.getAttribute("value");return{context:r,name:o,value:t}},u=Symbol(),l=Symbol(),ds=Symbol(),Ds=Symbol(),O=Symbol(),z=Symbol();class ${slots={};constructor(){this[z]("default")}[z](s){let r=k([]);Object.defineProperty(this.slots,s,{get(){return r.value},set(o){r.value=o}})}[l](s,r){Object.defineProperty(this,s,{get(){return r.value},set(o){r.value=o}})}[ds](s,r){Object.defineProperty(this,s,{get(){return r.value}})}[Ds](s,r){Object.defineProperty(this,s,{value:r})}[O](s,r){Object.defineProperty(this,s,{value:r,writable:!1})}}class w extends c{#s(s,r,o){if(s!==null){let t=s?s+"/":"",n=t+r,a=localStorage.getItem(n);if(a)o[r]=JSON.parse(a);h(()=>{localStorage.setItem(n,JSON.stringify(o[r]))})}}mount(){let{name:s,value:r,context:o}=Y(this);if(s&&r&&o){let t=Cs({value:r,context:o}),n=this.getAttribute("local-storage");o[l](s,k(t)),this.#s(n,s,o)}this.remove()}}class I extends c{mount(){let{name:s,value:r,context:o}=Y(this);if(s&&r&&o){let t=y(o,r);o[ds](s,t)}this.remove()}}class F extends c{mount(){let{name:s,value:r,context:o}=Y(this);if(s&&r&&o){let t=Cs({value:r,context:o});o[O](s,t)}this.remove()}}class V extends c{mount(){this.style.display="none";let{context:s,name:r}=Y(this),o=this.querySelector("script"),t=o?.textContent.trim()??"",n=o?.getAttribute("args")?.split(",")?.map((e)=>{let[f,i]=e.split(":").map((A)=>A.trim());return{name:f,type:i}}),a=n?.map((e)=>e.name).join(",");if(s&&t){let e=E(s,t,a);s[Ds](r,e)}else{if(!s)this.log("no context provided!");if(!t)this.log("no body provided!")}this.remove()}}var b={"bind:":"bind:","bool:":"bool:","on:":"on:","prop:":"prop:","ph:":"ph:"},Hs={"@":(s)=>s.replace("@",b["on:"]),".":(s)=>s.replace(".",b["prop:"]),"?":(s)=>s.replace("?",b["bool:"]),":":(s)=>s.replace(":",b["bind:"]),"*":(s)=>s.replace("*",b["ph:"])},K=(s)=>{let r=G(s);while(r.nextNode())ss(r.currentNode)},H=(s,r)=>{let o=[],t=B(s);while(t.nextNode()){let n=t.currentNode;o.push(...M(n,r))}return o},ss=(s)=>{for(let r of s.getAttributeNames()){let o=r,t=Hs[o[0]]?.(o);if(t)s.setAttribute(t,s.getAttribute(o)),s.removeAttribute(o)}},M=(s,r)=>{let o=[],t=s.getAttributeNames();for(let n of t){let a=s.getAttribute(n);if(a&&a!==""){if(n.startsWith(b["on:"])){let f=n.replace(b["on:"],""),i=E(r,a,"$e");setTimeout(()=>{s.addEventListener(f,i)}),s.removeAttribute(n)}if(n.startsWith(b["bind:"])){let f=y(r,a),i=n.replace(b["bind:"],"");o.push(h(()=>{if(f.value!==void 0&&f.value!==null)s.setAttribute(i,f.value);else s.removeAttribute(i)})),s.removeAttribute(n)}if(n.startsWith(b["prop:"])){let f=L(n.replace(b["prop:"],"")),i=y(r,a);o.push(h(()=>{let A=s[u]??s;if(A[f]!==i.value)A[f]=i.value})),s.removeAttribute(n)}if(n.startsWith(b["bool:"])){let f=n.replace(b["bool:"],""),i=y(r,a);o.push(h(()=>{if(i.value)s.toggleAttribute(f,!0);else s.toggleAttribute(f,!1)})),s.removeAttribute(n)}if(n.startsWith(b["ph:"])){let f=n.replace(b["ph:"],"");if(f==="if"){let i=y(r,a),A=document.createComment("ph-if");s.before(A),setTimeout(()=>{o.push(h(()=>{if(i.value)A.after(s);else s.remove()}))})}else if(f==="show"){let i=y(r,a),A=s.style.display;o.push(h(()=>{if(i.value)s.style.display=A;else s.style.display="none"}))}s.removeAttribute(n)}}}return o};var Ws=(s,r,o,t,n)=>{let a=s,e=(p)=>new RegExp(`([^a-zA-Z0-9$_]${p}[^a-zA-Z0-9$_:])`,"g"),f=(p)=>{let v=p.replace(e(o),(m)=>`${m[0]}${r}[${t}]?.valueOf()${m.at(-1)}`);if(n)return v.replace(e(n),(m)=>`${m[0]}${t}${m.at(-1)}`);return v},i=(p)=>{for(let v of p.getAttributeNames())if(Object.keys(b).some((m)=>v.startsWith(m)))p.setAttribute(v,f(` ${p.getAttribute(v)} `))},A=J(a.innerHTML,f);a.innerHTML=A,i(a);let x=G(a);while(x.nextNode()){let p=x.currentNode,v=p.tagName;if(i(p),p.hasAttribute("value")&&(v==="PH-IF"||v==="PH-EITHER"||v==="PH-SHOW"||v==="PH-SLOT"))p.setAttribute("value",f(` ${p.getAttribute("value")} `));if(v==="PH-DYNAMIC"&&p.hasAttribute("is"))p.setAttribute("is",f(` ${p.getAttribute("is")} `))}return a};class N extends c{mount(){this.style.display="contents";let s=this.firstElementChild;if(s?.tagName==="TEMPLATE")s.setAttribute("ph:each",this.getAttribute("ph:each")),N.fromTemplate(s);else throw Error("no template element provided")}static fromTemplate(s){K(s.content),s.before(document.createComment("ph-for begin")),s.after(document.createComment("ph-for end"));let r=s.getAttribute("ph:each"),o=s.previousSibling,t=s.nextSibling,n=s.getRootNode(),a=(n.host??n)[u],[e,f]=r?.split(" in ")??[],[i,A]=e.split(",").map((x)=>x.trim());if(a&&i&&f&&s){let x=y(a,f),p=0;h(()=>{let v=x.value.length;if(v!==p){if(v>p){let m=p;x.value.slice(m).forEach((D,P)=>{let T=s.content.firstElementChild.cloneNode(!0),S=Ws(T,f,i,P+m,A);t.before(S),S.disposes=[...H(S,a),...M(S,a)]})}else{let m=[],D=o.nextSibling,P=0;while(D&&D!==t){if(P>=v)m.push(D);P++,D=D.nextSibling}for(let T of m)T.disposes?.forEach((S)=>S()),T.remove?.()}p=x.value.length}})}s.remove()}}var rs=Symbol("ready");class os extends c{#s=this.attachShadow({mode:"open"});#r=new $;get[u](){return this.#r}async mount(){this.#r[O](rs,new Promise(async(s)=>{this.style.display="none";let r=this.getAttribute("name"),o=this.querySelector("template"),t=o.cloneNode(!0).content,n=[];document[u][`$${r}`]=this[u];let a;for(let e of t.querySelectorAll("script")){if(e.setAttribute("type","javascript/blocked"),e.hasAttribute("init"))a=E(this[u],e.textContent);if(e.hasAttribute("watch"))n.push(E(this[u],e.textContent));if(e.parentElement?.tagName!=="PH-METHOD")e.remove()}this.#s.append(t),await ts(t,this[u]),await a?.(),Object.seal(this[u]);for(let e of n)h(()=>{e()});s(!0)}))}}var $s=(s,r)=>{let o=void 0,t=[];s.querySelectorAll("slot").forEach((n)=>{if(n.hasAttribute("name"))t.push(n);else o??=n});for(let n of t){let a=n.getAttribute("name");r[z](a)}s.onslotchange=()=>{r.slots.default=o?.assignedElements()??[];for(let n of t){let a=n.getAttribute("name");if(r.slots)r.slots[a]=n.assignedElements()}}},Ms=(s,r)=>{for(let o of s.querySelectorAll("[ph\\:ref]")){let t=o.getAttribute("ph:ref");r[O](t,o),o.removeAttribute("ph:ref")}},Ps=(()=>{let s=null;return()=>{if(s===null)s=document.querySelector("style[global]");return s}})(),_s=(s,r=!1)=>{let o=s.querySelector("style"),t=new CSSStyleSheet,n=new CSSStyleSheet,a=new CSSStyleSheet;if(!o?.hasAttribute("isolated"))t.replaceSync(Ps()?.innerHTML??"");n.replaceSync(`:host { display: ${r?"inline-block":"block"}; ${r?"position: relative":""} }`),a.replaceSync(o?.textContent??""),o?.remove(),s.adoptedStyleSheets.push(t,n,a)},ks=(s,r)=>{let o=r.template,t=r.attributes??[],n=r.properties??[];if(!s)throw Error("no tag attribute was provided");let a=class extends c{#s;#r=[];#o;#t;get[u](){return this.#t}static observedAttributes=t;attributeChangedCallback(e,f,i){let A=L(e);if(this[u]&&f!==i)this[u][A]=i}constructor(){super();let e=r.closedShadowRoot?"closed":"open";if(this.#s=this.attachShadow({mode:e}),!this[u])this.#t=new $,Object.setPrototypeOf(this[u],document[u]),this[u][O]("self",this),this[u][O]("root",this.#s);for(let f of n)if(f)this[u][l](f,k(void 0))}async mount(){for(let T of t)if(T){let S=L(T);this[u][l](S,k(this.getAttribute(T))),this.#r.push(h(()=>{let Q=this[u][S];if(Q!==void 0&&Q!==null)this.setAttribute(T,Q);else this.removeAttribute(T)}))}let e=o.cloneNode(!0).content,f=e.querySelector("script[on-mount]"),i=e.querySelector("script[on-remove]"),A=e.querySelectorAll("script[watch]"),x=f?E(this[u],f.textContent):void 0,p=i?E(this[u],i.textContent):void 0,v=Array.from(A).map((T)=>{let S=E(this[u],T.textContent);return T.remove(),S});this.#o=p,f?.remove(),i?.remove(),K(e),us(e),Ms(e,this[u]);let m=r.stores?.map((T)=>document[u][`$${T}`][rs]);await Promise.all(m),r.stores.forEach((T)=>{this[u][O](T,document[u][`$${T}`])});let D=this.#s;D.append(e),$s(this.#s,this[u]),ns(D),await ts(D,this[u]),await x?.();let P=H(D,this[u]);this.#r.push(...P),Object.seal(this[u]);for(let T of v)this.#r.push(h(()=>{T()}));_s(D,r.inline)}unmount(){this.#o?.();for(let e of this.#r)e()}};d(s,a)},ns=(s)=>{for(let r of s.querySelectorAll("template[ph\\:each]"))N.fromTemplate(r)},us=(s)=>{let r=B(s);while(r.nextNode()){let o=r.currentNode;o.innerHTML=J(o.innerHTML)}},ts=async(s,r)=>{await Promise.all(Array.from(s.querySelectorAll("import[src]")).map(async(o)=>{let t=o.getAttribute("src"),n=t.includes(location.protocol)&&!(t.startsWith("/")||t.startsWith("./"))?t:`${location.origin}/${t}`,a=await import(n);for(let e of o.getAttributeNames()){let f=o.getAttribute(e)??e,i=a[L(e)];if(i)r[O](f,i)}o.remove();return}))};class fs extends c{mount(){let s=this.querySelector("template"),r=this.getAttribute("tag"),o=s.getAttribute("attributes")?.split(",")?.map((f)=>f.split(":")[0].trim()),t=s.getAttribute("properties")?.split(",")?.map((f)=>f.split(":")[0].trim()),n=s.hasAttribute("closed"),a=s.hasAttribute("inline"),e=s.getAttribute("use-stores")?.split(",")?.map((f)=>f.trim())??[];if(s?.tagName==="TEMPLATE")ks(r,{template:s,attributes:o,properties:t,inline:a,closedShadowRoot:n,stores:e});else throw Error("no template element provided")}}class es extends c{#s=[];#r;mount(){this.#r=this.childNodes,this.style.display="inline flow";let s=this.getAttribute("value"),r=this.getHost()?.[u];if(s&&r){let o=y(r,s);this.#s.push(...H(this,r)),this.#s.push(...M(this,r)),this.#s.push(h(()=>{if(o.value===!0)this.append(...this.#r);else this.#r=Array.from(this.childNodes).map((n)=>this.removeChild(n))}))}}unmount(){for(let s of this.#s)s()}}class as extends c{#s;mount(){this.style.display="inline flow";let s=this.getAttribute("value"),r=this.getHost()?.[u];if(s&&r){let o=y(r,s);this.#s=h(()=>{if(o.value)this.style.display="inline flow";else this.style.display="none"})}}unmount(){this.#s?.()}}class is extends c{#s=[];#r;#o;mount(){this.style.display="inline flow";let s=this.getAttribute("value"),r=this.getHost()?.[u];if(s&&r){this.#s.push(...H(this,r)),this.#s.push(...M(this,r));let[o,t]=this.children;this.#r=o,this.#o=t,this.innerHTML="";let n=y(r,s);this.#s.push(h(()=>{if(n.value){if(this.firstChild)this.#o=this.removeChild(this.firstChild);this.append(this.#r)}else{if(this.firstChild)this.#r=this.removeChild(this.firstChild);this.append(this.#o)}}))}}unmount(){for(let s of this.#s)s()}}class gs extends c{mount(){let s=this.getAttribute("is"),r=this.getHost()?.[u]??document[u],o=y(r,s);if(s&&r)h(()=>{setTimeout(()=>{this.replaceWith(o.value)})})}}class hs extends c{#s;mount(){setTimeout(()=>{this.style.display="contents";let s=this.getAttribute("value"),r=this.getHost()?.[u]??document[u];if(s&&r){let o=y(r,s);this.#s=h(()=>{this.textContent=o.value})}})}unmount(){this.#s?.()}}var Es=async()=>{console.group("ph init"),!document[u]&&Object.defineProperty(document,u,{value:new $,writable:!1}),d("ph-signal",w),d("ph-computed",I),d("ph-const",F),d("ph-method",V),d("ph-store",os),d("ph-for",N),d("ph-either",is),d("ph-show",as),d("ph-if",es),d("ph-slot",hs),d("ph-dynamic",gs),d("ph-component",fs);let s=B(document.body);while(s.nextNode()){let r=s.currentNode;ss(r)}us(document.body),H(document.body,document[u]),ns(document.body),console.groupEnd()};var no={init:Es};export{Es as init,no as default};
