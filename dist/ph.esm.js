class p extends HTMLElement{#s=[];log(...s){let o=this.id?` #${this.id}`:"",r=this.getAttribute("name")?` :${this.getAttribute("name")}`:"";console.log(`[${this.tagName}${r}${o}]`,...s)}mount(){}unmount(){}connectedCallback(){this.mount()}disconnectedCallback(){this.unmount(),this.#s?.forEach((s)=>s()),this.#s=[]}on(s,o){return this.addEventListener(s,o)}getHost(){let s=this.getRootNode();return s.host??s}emit(s,o){let r=!o?new Event(s,{composed:!0}):new CustomEvent(s,{detail:o,composed:!0});this.dispatchEvent(r)}defer(s){this.#s.push(s)}}var Es=Symbol.for("preact-signals");function Z(){if(!(_>1)){var s,o=!1;while(l!==void 0){var r=l;l=void 0,U++;while(r!==void 0){var t=r.o;if(r.o=void 0,r.f&=-3,!(8&r.f)&&Ts(r))try{r.c()}catch(n){if(!o)s=n,o=!0}r=t}}if(U=0,_--,o)throw s}else _--}var c=void 0;function hs(s){var o=c;c=void 0;try{return s()}finally{c=o}}var l=void 0,_=0,U=0,q=0;function ps(s){if(c!==void 0){var o=s.n;if(o===void 0||o.t!==c){if(o={i:0,S:s,p:c.s,n:void 0,t:c,e:void 0,x:void 0,r:o},c.s!==void 0)c.s.n=o;if(c.s=o,s.n=o,32&c.f)s.S(o);return o}else if(o.i===-1){if(o.i=0,o.n!==void 0){if(o.n.p=o.p,o.p!==void 0)o.p.n=o.n;o.p=c.s,o.n=void 0,c.s.n=o,c.s=o}return o}}}function C(s,o){this.v=s,this.i=0,this.n=void 0,this.t=void 0,this.W=o==null?void 0:o.watched,this.Z=o==null?void 0:o.unwatched,this.name=o==null?void 0:o.name}C.prototype.brand=Es;C.prototype.h=function(){return!0};C.prototype.S=function(s){var o=this,r=this.t;if(r!==s&&s.e===void 0)if(s.x=r,this.t=s,r!==void 0)r.e=s;else hs(function(){var t;(t=o.W)==null||t.call(o)})};C.prototype.U=function(s){var o=this;if(this.t!==void 0){var{e:r,x:t}=s;if(r!==void 0)r.x=t,s.e=void 0;if(t!==void 0)t.e=r,s.x=void 0;if(s===this.t){if(this.t=t,t===void 0)hs(function(){var n;(n=o.Z)==null||n.call(o)})}}};C.prototype.subscribe=function(s){var o=this;return g(function(){var r=o.value,t=c;c=void 0;try{s(r)}finally{c=t}},{name:"sub"})};C.prototype.valueOf=function(){return this.value};C.prototype.toString=function(){return this.value+""};C.prototype.toJSON=function(){return this.value};C.prototype.peek=function(){var s=c;c=void 0;try{return this.value}finally{c=s}};Object.defineProperty(C.prototype,"value",{get:function(){var s=ps(this);if(s!==void 0)s.i=this.i;return this.v},set:function(s){if(s!==this.v){if(U>100)throw Error("Cycle detected");this.v=s,this.i++,q++,_++;try{for(var o=this.t;o!==void 0;o=o.x)o.t.N()}finally{Z()}}}});function k(s,o){return new C(s,o)}function Ts(s){for(var o=s.s;o!==void 0;o=o.n)if(o.S.i!==o.i||!o.S.h()||o.S.i!==o.i)return!0;return!1}function ys(s){for(var o=s.s;o!==void 0;o=o.n){var r=o.S.n;if(r!==void 0)o.r=r;if(o.S.n=o,o.i=-1,o.n===void 0){s.s=o;break}}}function As(s){var o=s.s,r=void 0;while(o!==void 0){var t=o.p;if(o.i===-1){if(o.S.U(o),t!==void 0)t.n=o.n;if(o.n!==void 0)o.n.p=t}else r=o;if(o.S.n=o.r,o.r!==void 0)o.r=void 0;o=t}s.s=r}function W(s,o){C.call(this,void 0),this.x=s,this.s=void 0,this.g=q-1,this.f=4,this.W=o==null?void 0:o.watched,this.Z=o==null?void 0:o.unwatched,this.name=o==null?void 0:o.name}W.prototype=new C;W.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32)return!0;if(this.f&=-5,this.g===q)return!0;if(this.g=q,this.f|=1,this.i>0&&!Ts(this))return this.f&=-2,!0;var s=c;try{ys(this),c=this;var o=this.x();if(16&this.f||this.v!==o||this.i===0)this.v=o,this.f&=-17,this.i++}catch(r){this.v=r,this.f|=16,this.i++}return c=s,As(this),this.f&=-2,!0};W.prototype.S=function(s){if(this.t===void 0){this.f|=36;for(var o=this.s;o!==void 0;o=o.n)o.S.S(o)}C.prototype.S.call(this,s)};W.prototype.U=function(s){if(this.t!==void 0){if(C.prototype.U.call(this,s),this.t===void 0){this.f&=-33;for(var o=this.s;o!==void 0;o=o.n)o.S.U(o)}}};W.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var s=this.t;s!==void 0;s=s.x)s.t.N()}};Object.defineProperty(W.prototype,"value",{get:function(){if(1&this.f)throw Error("Cycle detected");var s=ps(this);if(this.h(),s!==void 0)s.i=this.i;if(16&this.f)throw this.v;return this.v}});function vs(s,o){return new W(s,o)}function bs(s){var o=s.u;if(s.u=void 0,typeof o=="function"){_++;var r=c;c=void 0;try{o()}catch(t){throw s.f&=-2,s.f|=8,w(s),t}finally{c=r,Z()}}}function w(s){for(var o=s.s;o!==void 0;o=o.n)o.S.U(o);s.x=void 0,s.s=void 0,bs(s)}function xs(s){if(c!==this)throw Error("Out-of-order effect");if(As(this),c=s,this.f&=-2,8&this.f)w(this);Z()}function j(s,o){this.x=s,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32,this.name=o==null?void 0:o.name}j.prototype.c=function(){var s=this.S();try{if(8&this.f)return;if(this.x===void 0)return;var o=this.x();if(typeof o=="function")this.u=o}finally{s()}};j.prototype.S=function(){if(1&this.f)throw Error("Cycle detected");this.f|=1,this.f&=-9,bs(this),ys(this),_++;var s=c;return c=this,xs.bind(this,s)};j.prototype.N=function(){if(!(2&this.f))this.f|=2,this.o=l,l=this};j.prototype.d=function(){if(this.f|=8,!(1&this.f))w(this)};j.prototype.dispose=function(){this.d()};function g(s,o){var r=new j(s,o);try{r.c()}catch(n){throw r.d(),n}var t=r.d.bind(r);return t[Symbol.dispose]=t,t}var Os=(s,o)=>s.replace(/{{[^{}]*}}/g,(r)=>o(r.replace(/[{}]/g,""))),ms=document.createTreeWalker.bind(document),d=(s,o)=>!customElements.get(s)&&customElements.define(s,o),L=(s)=>s.replace(/-[a-z]/g,(o)=>o[1].toUpperCase()),J=(s,o)=>{return Os(s,(r)=>{let t=r.replace(/[{}]/g," ");if(o)t=o(t);return`<ph-slot value="${t}"></ph-slot>`})},y=(s,o)=>{return Function("context","computed",`with(context){return computed(() => ${o})}`)(s,vs)},D=(s,o,r="")=>{let t=o??"",n=o?.includes("await");return Function("context",`return ${n?"async":""} function(${r}){with (context) {${t}}}`)(s)},B=(s)=>{return ms(s,NodeFilter.SHOW_ELEMENT,(o)=>o.tagName!=="TEMPLATE"?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT)},G=(s,o)=>{return ms(s,NodeFilter.SHOW_ELEMENT,o)};var Cs=({value:s,context:o})=>{try{return D(o,`return ${s}`)()}catch(r){console.error(r)}},Y=(s)=>{let o=s.getHost()?.[u]??document[u],r=s.getAttribute("name"),t=s.getAttribute("value");return{context:o,name:r,value:t}},u=Symbol(),X=Symbol(),ds=Symbol(),Ss=Symbol(),O=Symbol(),z=Symbol();class ${slots={};constructor(){this[z]("default")}[z](s){let o=k([]);Object.defineProperty(this.slots,s,{get(){return o.value},set(r){o.value=r}})}[X](s,o){Object.defineProperty(this,s,{get(){return o.value},set(r){o.value=r}})}[ds](s,o){Object.defineProperty(this,s,{get(){return o.value}})}[Ss](s,o){Object.defineProperty(this,s,{value:o})}[O](s,o){Object.defineProperty(this,s,{value:o,writable:!1})}}class R extends p{#s(s,o,r){if(s!==null){let t=s?s+"/":"",n=t+o,f=localStorage.getItem(n);if(f)r[o]=JSON.parse(f);g(()=>{localStorage.setItem(n,JSON.stringify(r[o]))})}}mount(){let{name:s,value:o,context:r}=Y(this);if(s&&o&&r){let t=Cs({value:o,context:r}),n=this.getAttribute("local-storage");r[X](s,k(t)),this.#s(n,s,r)}this.remove()}}class I extends p{mount(){let{name:s,value:o,context:r}=Y(this);if(s&&o&&r){let t=y(r,o);r[ds](s,t)}this.remove()}}class F extends p{mount(){let{name:s,value:o,context:r}=Y(this);if(s&&o&&r){let t=Cs({value:o,context:r});r[O](s,t)}this.remove()}}class V extends p{mount(){this.style.display="none";let{context:s,name:o}=Y(this),r=this.querySelector("script"),t=r?.textContent.trim()??"",n=r?.getAttribute("args")?.split(",")?.map((e)=>{let[a,i]=e.split(":").map((v)=>v.trim());return{name:a,type:i}}),f=n?.map((e)=>e.name).join(",");if(s&&t){let e=D(s,t,f);s[Ss](o,e)}else{if(!s)this.log("no context provided!");if(!t)this.log("no body provided!")}this.remove()}}var b={"bind:":"bind:","bool:":"bool:","on:":"on:","prop:":"prop:","ph:":"ph:"},Hs={"@":(s)=>s.replace("@",b["on:"]),".":(s)=>s.replace(".",b["prop:"]),"?":(s)=>s.replace("?",b["bool:"]),":":(s)=>s.replace(":",b["bind:"]),"*":(s)=>s.replace("*",b["ph:"])},K=(s)=>{let o=G(s);while(o.nextNode())ss(o.currentNode)},H=(s,o)=>{let r=[],t=B(s);while(t.nextNode()){let n=t.currentNode;r.push(...M(n,o))}return r},ss=(s)=>{for(let o of s.getAttributeNames()){let r=o,t=Hs[r[0]]?.(r);if(t)s.setAttribute(t,s.getAttribute(r)),s.removeAttribute(r)}},M=(s,o)=>{let r=[],t=s.getAttributeNames();for(let n of t){let f=s.getAttribute(n);if(f&&f!==""){if(n.startsWith(b["on:"])){let a=n.replace(b["on:"],""),i=D(o,f,"$e");setTimeout(()=>{s.addEventListener(a,i)}),s.removeAttribute(n)}if(n.startsWith(b["bind:"])){let a=y(o,f),i=n.replace(b["bind:"],"");r.push(g(()=>{if(a.value!==void 0&&a.value!==null)s.setAttribute(i,a.value);else s.removeAttribute(i)})),s.removeAttribute(n)}if(n.startsWith(b["prop:"])){let a=L(n.replace(b["prop:"],"")),i=y(o,f);r.push(g(()=>{let v=s[u]??s;if(v[a]!==i.value)v[a]=i.value})),s.removeAttribute(n)}if(n.startsWith(b["bool:"])){let a=n.replace(b["bool:"],""),i=y(o,f);r.push(g(()=>{if(i.value)s.toggleAttribute(a,!0);else s.toggleAttribute(a,!1)})),s.removeAttribute(n)}if(n.startsWith(b["ph:"])){let a=n.replace(b["ph:"],"");if(a==="if"){let i=y(o,f),v=document.createComment("ph-if");s.before(v),setTimeout(()=>{r.push(g(()=>{if(i.value)v.after(s);else s.remove()}))})}else if(a==="show"){let i=y(o,f),v=s.style.display;r.push(g(()=>{if(i.value)s.style.display=v;else s.style.display="none"}))}s.removeAttribute(n)}}}return r};var Ws=(s,o,r,t,n)=>{let f=s,e=(h)=>new RegExp(`([^a-zA-Z0-9$_]${h}[^a-zA-Z0-9$_:])`,"g"),a=(h)=>{let A=h.replace(e(r),(m)=>`${m[0]}${o}[${t}]?.valueOf()${m.at(-1)}`);if(n)return A.replace(e(n),(m)=>`${m[0]}${t}${m.at(-1)}`);return A},i=(h)=>{for(let A of h.getAttributeNames())if(Object.keys(b).some((m)=>A.startsWith(m)))h.setAttribute(A,a(` ${h.getAttribute(A)} `))},v=J(f.innerHTML,a);f.innerHTML=v,i(f);let x=G(f);while(x.nextNode()){let h=x.currentNode,A=h.tagName;if(i(h),h.hasAttribute("value")&&(A==="PH-IF"||A==="PH-EITHER"||A==="PH-SHOW"||A==="PH-SLOT"))h.setAttribute("value",a(` ${h.getAttribute("value")} `));if(A==="PH-DYNAMIC"&&h.hasAttribute("is"))h.setAttribute("is",a(` ${h.getAttribute("is")} `))}return f};class N extends p{mount(){this.style.display="contents";let s=this.firstElementChild;if(s?.tagName==="TEMPLATE")s.setAttribute("ph:each",this.getAttribute("ph:each")),N.fromTemplate(s);else throw Error("no template element provided")}static fromTemplate(s){K(s.content),s.before(document.createComment("ph-for begin")),s.after(document.createComment("ph-for end"));let o=s.getAttribute("ph:each"),r=s.previousSibling,t=s.nextSibling,n=s.getRootNode(),f=(n.host??n)[u],[e,a]=o?.split(" in ")??[],[i,v]=e.split(",").map((x)=>x.trim());if(f&&i&&a&&s){let x=y(f,a),h=0;g(()=>{let A=x.value.length;if(A!==h){if(A>h){let m=h;x.value.slice(m).forEach((S,P)=>{let T=s.content.firstElementChild.cloneNode(!0),E=Ws(T,a,i,P+m,v);t.before(E),E.disposes=[...H(E,f),...M(E,f)]})}else{let m=[],S=r.nextSibling,P=0;while(S&&S!==t){if(P>=A)m.push(S);P++,S=S.nextSibling}for(let T of m)T.disposes?.forEach((E)=>E()),T.remove?.()}h=x.value.length}})}s.remove()}}var os=Symbol("ready");class rs extends p{#s=this.attachShadow({mode:"open"});#o=new $;get[u](){return this.#o}async mount(){this.#o[O](os,new Promise(async(s)=>{this.style.display="none";let o=this.getAttribute("name"),r=this.querySelector("template"),t=r.cloneNode(!0).content,n=[];document[u][`$${o}`]=this[u];let f;for(let e of t.querySelectorAll("script")){if(e.setAttribute("type","javascript/blocked"),e.hasAttribute("init"))f=D(this[u],e.textContent);if(e.hasAttribute("watch"))n.push(D(this[u],e.textContent));if(e.parentElement?.tagName!=="PH-METHOD")e.remove()}this.#s.append(t),await ts(t,this[u]),await f?.(),Object.seal(this[u]);for(let e of n)g(()=>{e()});s(!0)}))}}var $s=(s,o)=>{let r=s.querySelectorAll("slot").values(),t=r.find((f)=>!f.hasAttribute("name")),n=Array.from(r.filter((f)=>f.hasAttribute("name")));for(let f of n){let e=f.getAttribute("name");o[z](e)}s.onslotchange=()=>{o.slots.default=t?.assignedElements();for(let f of n){let e=f.getAttribute("name");if(o.slots)o.slots[e]=f.assignedElements()}}},Ms=(s,o)=>{for(let r of s.querySelectorAll("[ph\\:ref]")){let t=r.getAttribute("ph:ref");o[O](t,r),r.removeAttribute("ph:ref")}},Ps=(()=>{let s=null;return()=>{if(s===null)s=document.querySelector("style[global]");return s}})(),_s=(s,o=!1)=>{let r=s.querySelector("style"),t=new CSSStyleSheet,n=new CSSStyleSheet,f=new CSSStyleSheet;if(!r?.hasAttribute("isolated"))t.replaceSync(Ps()?.innerHTML??"");n.replaceSync(`:host { display: ${o?"inline-block":"block"}; ${o?"position: relative":""} }`),f.replaceSync(r?.textContent??""),r?.remove(),s.adoptedStyleSheets.push(t,n,f)},ks=(s,o)=>{let r=o.template,t=o.attributes??[],n=o.properties??[];if(!s)throw Error("no tag attribute was provided");let f=class extends p{#s;#o=[];#r;#t;get[u](){return this.#t}static observedAttributes=t;attributeChangedCallback(e,a,i){let v=L(e);if(this[u]&&a!==i)this[u][v]=i}constructor(){super();let e=o.closedShadowRoot?"closed":"open";if(this.#s=this.attachShadow({mode:e}),!this[u])this.#t=new $,Object.setPrototypeOf(this[u],document[u]),this[u][O]("self",this),this[u][O]("root",this.#s);for(let a of n)if(a)this[u][X](a,k(void 0))}async mount(){for(let T of t)if(T){let E=L(T);this[u][X](E,k(this.getAttribute(T))),this.#o.push(g(()=>{let Q=this[u][E];if(Q!==void 0&&Q!==null)this.setAttribute(T,Q);else this.removeAttribute(T)}))}let e=r.cloneNode(!0).content,a=e.querySelector("script[on-mount]"),i=e.querySelector("script[on-remove]"),v=e.querySelectorAll("script[watch]"),x=a?D(this[u],a.textContent):void 0,h=i?D(this[u],i.textContent):void 0,A=Array.from(v).map((T)=>{let E=D(this[u],T.textContent);return T.remove(),E});this.#r=h,a?.remove(),i?.remove(),K(e),us(e),Ms(e,this[u]);let m=o.stores?.map((T)=>document[u][`$${T}`][os]);await Promise.all(m),o.stores.forEach((T)=>{this[u][O](T,document[u][`$${T}`])});let S=this.#s;S.append(e),$s(this.#s,this[u]),ns(S),await ts(S,this[u]),await x?.();let P=H(S,this[u]);this.#o.push(...P),Object.seal(this[u]);for(let T of A)this.#o.push(g(()=>{T()}));_s(S,o.inline)}unmount(){this.#r?.();for(let e of this.#o)e()}};d(s,f)},ns=(s)=>{for(let o of s.querySelectorAll("template[ph\\:each]"))N.fromTemplate(o)},us=(s)=>{let o=B(s);while(o.nextNode()){let r=o.currentNode;r.innerHTML=J(r.innerHTML)}},ts=async(s,o)=>{await Promise.all(Array.from(s.querySelectorAll("import[src]")).map(async(r)=>{let t=r.getAttribute("src"),n=t.includes(location.protocol)&&!(t.startsWith("/")||t.startsWith("./"))?t:`${location.origin}/${t}`,f=await import(n);for(let e of r.getAttributeNames()){let a=r.getAttribute(e)??e,i=f[L(e)];if(i)o[O](a,i)}r.remove();return}))};class fs extends p{mount(){let s=this.querySelector("template"),o=this.getAttribute("tag"),r=s.getAttribute("attributes")?.split(",")?.map((a)=>a.split(":")[0].trim()),t=s.getAttribute("properties")?.split(",")?.map((a)=>a.split(":")[0].trim()),n=s.hasAttribute("closed"),f=s.hasAttribute("inline"),e=s.getAttribute("use-stores")?.split(",")?.map((a)=>a.trim())??[];if(s?.tagName==="TEMPLATE")ks(o,{template:s,attributes:r,properties:t,inline:f,closedShadowRoot:n,stores:e});else throw Error("no template element provided")}}class es extends p{#s=[];#o;mount(){this.#o=this.childNodes,this.style.display="inline flow";let s=this.getAttribute("value"),o=this.getHost()?.[u];if(s&&o){let r=y(o,s);this.#s.push(...H(this,o)),this.#s.push(...M(this,o)),this.#s.push(g(()=>{if(r.value===!0)this.append(...this.#o);else this.#o=Array.from(this.childNodes).map((n)=>this.removeChild(n))}))}}unmount(){for(let s of this.#s)s()}}class as extends p{#s;mount(){this.style.display="inline flow";let s=this.getAttribute("value"),o=this.getHost()?.[u];if(s&&o){let r=y(o,s);this.#s=g(()=>{if(r.value)this.style.display="inline flow";else this.style.display="none"})}}unmount(){this.#s?.()}}class is extends p{#s=[];#o;#r;mount(){this.style.display="inline flow";let s=this.getAttribute("value"),o=this.getHost()?.[u];if(s&&o){this.#s.push(...H(this,o)),this.#s.push(...M(this,o));let[r,t]=this.children;this.#o=r,this.#r=t,this.innerHTML="";let n=y(o,s);this.#s.push(g(()=>{if(n.value){if(this.firstChild)this.#r=this.removeChild(this.firstChild);this.append(this.#o)}else{if(this.firstChild)this.#o=this.removeChild(this.firstChild);this.append(this.#r)}}))}}unmount(){for(let s of this.#s)s()}}class cs extends p{mount(){let s=this.getAttribute("is"),o=this.getHost()?.[u]??document[u],r=y(o,s);if(s&&o)g(()=>{setTimeout(()=>{this.replaceWith(r.value)})})}}class gs extends p{#s;mount(){setTimeout(()=>{this.style.display="contents";let s=this.getAttribute("value"),o=this.getHost()?.[u]??document[u];if(s&&o){let r=y(o,s);this.#s=g(()=>{this.textContent=r.value})}})}unmount(){this.#s?.()}}var Ds=async()=>{console.group("ph init"),!document[u]&&Object.defineProperty(document,u,{value:new $,writable:!1}),d("ph-signal",R),d("ph-computed",I),d("ph-const",F),d("ph-method",V),d("ph-store",rs),d("ph-for",N),d("ph-either",is),d("ph-show",as),d("ph-if",es),d("ph-slot",gs),d("ph-dynamic",cs),d("ph-component",fs);let s=B(document.body);while(s.nextNode()){let o=s.currentNode;ss(o)}us(document.body),H(document.body,document[u]),ns(document.body),console.groupEnd()};var ur={init:Ds};export{Ds as init,ur as default};
