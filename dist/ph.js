(()=>{class p extends HTMLElement{#s=[];log(...s){let o=this.id?` #${this.id}`:"",r=this.getAttribute("name")?` :${this.getAttribute("name")}`:"";console.log(`[${this.tagName}${r}${o}]`,...s)}mount(){}unmount(){}connectedCallback(){this.mount()}disconnectedCallback(){this.unmount(),this.#s?.forEach((s)=>s()),this.#s=[]}on(s,o){return this.addEventListener(s,o)}getHost(){let s=this.getRootNode();return s.host??s}emit(s,o){let r=!o?new Event(s,{composed:!0}):new CustomEvent(s,{detail:o,composed:!0});this.dispatchEvent(r)}onRemove(s){this.#s.push(s)}}var Ss=Symbol.for("preact-signals");function U(){if(!(_>1)){var s,o=!1;while(X!==void 0){var r=X;X=void 0,Q++;while(r!==void 0){var t=r.o;if(r.o=void 0,r.f&=-3,!(8&r.f)&&Ts(r))try{r.c()}catch(n){if(!o)s=n,o=!0}r=t}}if(Q=0,_--,o)throw s}else _--}var h=void 0;function cs(s){var o=h;h=void 0;try{return s()}finally{h=o}}var X=void 0,_=0,Q=0,J=0;function ps(s){if(h!==void 0){var o=s.n;if(o===void 0||o.t!==h){if(o={i:0,S:s,p:h.s,n:void 0,t:h,e:void 0,x:void 0,r:o},h.s!==void 0)h.s.n=o;if(h.s=o,s.n=o,32&h.f)s.S(o);return o}else if(o.i===-1){if(o.i=0,o.n!==void 0){if(o.n.p=o.p,o.p!==void 0)o.p.n=o.n;o.p=h.s,o.n=void 0,h.s.n=o,h.s=o}return o}}}function C(s,o){this.v=s,this.i=0,this.n=void 0,this.t=void 0,this.W=o==null?void 0:o.watched,this.Z=o==null?void 0:o.unwatched,this.name=o==null?void 0:o.name}C.prototype.brand=Ss;C.prototype.h=function(){return!0};C.prototype.S=function(s){var o=this,r=this.t;if(r!==s&&s.e===void 0)if(s.x=r,this.t=s,r!==void 0)r.e=s;else cs(function(){var t;(t=o.W)==null||t.call(o)})};C.prototype.U=function(s){var o=this;if(this.t!==void 0){var{e:r,x:t}=s;if(r!==void 0)r.x=t,s.e=void 0;if(t!==void 0)t.e=r,s.x=void 0;if(s===this.t){if(this.t=t,t===void 0)cs(function(){var n;(n=o.Z)==null||n.call(o)})}}};C.prototype.subscribe=function(s){var o=this;return g(function(){var r=o.value,t=h;h=void 0;try{s(r)}finally{h=t}},{name:"sub"})};C.prototype.valueOf=function(){return this.value};C.prototype.toString=function(){return this.value+""};C.prototype.toJSON=function(){return this.value};C.prototype.peek=function(){var s=h;h=void 0;try{return this.value}finally{h=s}};Object.defineProperty(C.prototype,"value",{get:function(){var s=ps(this);if(s!==void 0)s.i=this.i;return this.v},set:function(s){if(s!==this.v){if(Q>100)throw Error("Cycle detected");this.v=s,this.i++,J++,_++;try{for(var o=this.t;o!==void 0;o=o.x)o.t.N()}finally{U()}}}});function k(s,o){return new C(s,o)}function Ts(s){for(var o=s.s;o!==void 0;o=o.n)if(o.S.i!==o.i||!o.S.h()||o.S.i!==o.i)return!0;return!1}function ys(s){for(var o=s.s;o!==void 0;o=o.n){var r=o.S.n;if(r!==void 0)o.r=r;if(o.S.n=o,o.i=-1,o.n===void 0){s.s=o;break}}}function vs(s){var o=s.s,r=void 0;while(o!==void 0){var t=o.p;if(o.i===-1){if(o.S.U(o),t!==void 0)t.n=o.n;if(o.n!==void 0)o.n.p=t}else r=o;if(o.S.n=o.r,o.r!==void 0)o.r=void 0;o=t}s.s=r}function W(s,o){C.call(this,void 0),this.x=s,this.s=void 0,this.g=J-1,this.f=4,this.W=o==null?void 0:o.watched,this.Z=o==null?void 0:o.unwatched,this.name=o==null?void 0:o.name}W.prototype=new C;W.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32)return!0;if(this.f&=-5,this.g===J)return!0;if(this.g=J,this.f|=1,this.i>0&&!Ts(this))return this.f&=-2,!0;var s=h;try{ys(this),h=this;var o=this.x();if(16&this.f||this.v!==o||this.i===0)this.v=o,this.f&=-17,this.i++}catch(r){this.v=r,this.f|=16,this.i++}return h=s,vs(this),this.f&=-2,!0};W.prototype.S=function(s){if(this.t===void 0){this.f|=36;for(var o=this.s;o!==void 0;o=o.n)o.S.S(o)}C.prototype.S.call(this,s)};W.prototype.U=function(s){if(this.t!==void 0){if(C.prototype.U.call(this,s),this.t===void 0){this.f&=-33;for(var o=this.s;o!==void 0;o=o.n)o.S.U(o)}}};W.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var s=this.t;s!==void 0;s=s.x)s.t.N()}};Object.defineProperty(W.prototype,"value",{get:function(){if(1&this.f)throw Error("Cycle detected");var s=ps(this);if(this.h(),s!==void 0)s.i=this.i;if(16&this.f)throw this.v;return this.v}});function As(s,o){return new W(s,o)}function bs(s){var o=s.u;if(s.u=void 0,typeof o=="function"){_++;var r=h;h=void 0;try{o()}catch(t){throw s.f&=-2,s.f|=8,Z(s),t}finally{h=r,U()}}}function Z(s){for(var o=s.s;o!==void 0;o=o.n)o.S.U(o);s.x=void 0,s.s=void 0,bs(s)}function xs(s){if(h!==this)throw Error("Out-of-order effect");if(vs(this),h=s,this.f&=-2,8&this.f)Z(this);U()}function j(s,o){this.x=s,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32,this.name=o==null?void 0:o.name}j.prototype.c=function(){var s=this.S();try{if(8&this.f)return;if(this.x===void 0)return;var o=this.x();if(typeof o=="function")this.u=o}finally{s()}};j.prototype.S=function(){if(1&this.f)throw Error("Cycle detected");this.f|=1,this.f&=-9,bs(this),ys(this),_++;var s=h;return h=this,xs.bind(this,s)};j.prototype.N=function(){if(!(2&this.f))this.f|=2,this.o=X,X=this};j.prototype.d=function(){if(this.f|=8,!(1&this.f))Z(this)};j.prototype.dispose=function(){this.d()};function g(s,o){var r=new j(s,o);try{r.c()}catch(n){throw r.d(),n}var t=r.d.bind(r);return t[Symbol.dispose]=t,t}var Os=(s,o)=>s.replace(/{{[^{}]*}}/g,(r)=>o(r.replace(/[{}]/g,""))),ms=document.createTreeWalker.bind(document),d=(s,o)=>!customElements.get(s)&&customElements.define(s,o),L=(s)=>s.replace(/-[a-z]/g,(o)=>o[1].toUpperCase()),l=(s,o)=>{return Os(s,(r)=>{let t=r.replace(/[{}]/g," ");if(o)t=o(t);return`<ph-slot value="${t}"></ph-slot>`})},y=(s,o)=>{return Function("context","computed",`with(context){return computed(() => ${o})}`)(s,As)},E=(s,o,r="")=>{let t=o??"",n=o?.includes("await");return Function("context",`return ${n?"async":""} function(${r}){with (context) {${t}}}`)(s)},B=(s)=>{return ms(s,NodeFilter.SHOW_ELEMENT,(o)=>o.tagName!=="TEMPLATE"?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT)},G=(s,o)=>{return ms(s,NodeFilter.SHOW_ELEMENT,o)};var Cs=({value:s,context:o})=>{try{return E(o,`return ${s}`)()}catch(r){console.error(r)}},Y=(s)=>{let o=s.getHost()?.[u]??document[u],r=s.getAttribute("name"),t=s.getAttribute("value");return{context:o,name:r,value:t}},u=Symbol(),q=Symbol(),ds=Symbol(),Ds=Symbol(),O=Symbol(),z=Symbol();class ${slots={};constructor(){this[z]("default")}[z](s){let o=k([]);Object.defineProperty(this.slots,s,{get(){return o.value},set(r){o.value=r}})}[q](s,o){Object.defineProperty(this,s,{get(){return o.value},set(r){o.value=r}})}[ds](s,o){Object.defineProperty(this,s,{get(){return o.value}})}[Ds](s,o){Object.defineProperty(this,s,{value:o})}[O](s,o){Object.defineProperty(this,s,{value:o,writable:!1})}}class R extends p{#s(s,o,r){if(s!==null){let t=s?s+"/":"",n=t+o,i=localStorage.getItem(n);if(i)r[o]=JSON.parse(i);g(()=>{localStorage.setItem(n,JSON.stringify(r[o]))})}}mount(){let{name:s,value:o,context:r}=Y(this);if(s&&o&&r){let t=Cs({value:o,context:r}),n=this.getAttribute("local-storage");r[q](s,k(t)),this.#s(n,s,r)}this.remove()}}class I extends p{mount(){let{name:s,value:o,context:r}=Y(this);if(s&&o&&r){let t=y(r,o);r[ds](s,t)}this.remove()}}class F extends p{mount(){let{name:s,value:o,context:r}=Y(this);if(s&&o&&r){let t=Cs({value:o,context:r});r[O](s,t)}this.remove()}}class V extends p{mount(){this.style.display="none";let{context:s,name:o}=Y(this),r=this.querySelector("script"),t=r?.textContent.trim()??"",n=r?.getAttribute("args")?.split(",")?.map((e)=>{let[f,a]=e.split(":").map((A)=>A.trim());return{name:f,type:a}}),i=n?.map((e)=>e.name).join(",");if(s&&t){let e=E(s,t,i);s[Ds](o,e)}else{if(!s)this.log("no context provided!");if(!t)this.log("no body provided!")}this.remove()}}var b={"bind:":"bind:","bool:":"bool:","on:":"on:","prop:":"prop:","ph:":"ph:"},Hs={"@":(s)=>s.replace("@",b["on:"]),".":(s)=>s.replace(".",b["prop:"]),"?":(s)=>s.replace("?",b["bool:"]),":":(s)=>s.replace(":",b["bind:"]),"*":(s)=>s.replace("*",b["ph:"])},w=(s)=>{let o=G(s);while(o.nextNode())ss(o.currentNode)},H=(s,o)=>{let r=[],t=B(s);while(t.nextNode()){let n=t.currentNode;r.push(...M(n,o))}return r},ss=(s)=>{for(let o of s.getAttributeNames()){let r=o,t=Hs[r[0]]?.(r);if(t)s.setAttribute(t,s.getAttribute(r)),s.removeAttribute(r)}},M=(s,o)=>{let r=[],t=s.getAttributeNames();for(let n of t){let i=s.getAttribute(n);if(i&&i!==""){if(n.startsWith(b["on:"])){let f=n.replace(b["on:"],""),a=E(o,i,"$e");setTimeout(()=>{s.addEventListener(f,a)}),s.removeAttribute(n)}if(n.startsWith(b["bind:"])){let f=y(o,i),a=n.replace(b["bind:"],"");r.push(g(()=>{if(f.value!==void 0&&f.value!==null)s.setAttribute(a,f.value);else s.removeAttribute(a)})),s.removeAttribute(n)}if(n.startsWith(b["prop:"])){let f=L(n.replace(b["prop:"],"")),a=y(o,i);r.push(g(()=>{let A=s[u]??s;if(A[f]!==a.value)A[f]=a.value})),s.removeAttribute(n)}if(n.startsWith(b["bool:"])){let f=n.replace(b["bool:"],""),a=y(o,i);r.push(g(()=>{if(a.value)s.toggleAttribute(f,!0);else s.toggleAttribute(f,!1)})),s.removeAttribute(n)}if(n.startsWith(b["ph:"])){let f=n.replace(b["ph:"],"");if(f==="if"){let a=y(o,i),A=document.createComment("ph-if");s.before(A),setTimeout(()=>{r.push(g(()=>{if(a.value)A.after(s);else s.remove()}))})}else if(f==="show"){let a=y(o,i),A=s.style.display;r.push(g(()=>{if(a.value)s.style.display=A;else s.style.display="none"}))}s.removeAttribute(n)}}}return r};var Ws=(s,o,r,t,n)=>{let i=s,e=(c)=>new RegExp(`([^a-zA-Z0-9$_]${c}[^a-zA-Z0-9$_:])`,"g"),f=(c)=>{let v=c.replace(e(r),(m)=>`${m[0]}${o}[${t}]?.valueOf()${m.at(-1)}`);if(n)return v.replace(e(n),(m)=>`${m[0]}${t}${m.at(-1)}`);return v},a=(c)=>{for(let v of c.getAttributeNames())if(Object.keys(b).some((m)=>v.startsWith(m)))c.setAttribute(v,f(` ${c.getAttribute(v)} `))},A=l(i.innerHTML,f);i.innerHTML=A,a(i);let x=G(i);while(x.nextNode()){let c=x.currentNode,v=c.tagName;if(a(c),c.hasAttribute("value")&&(v==="PH-IF"||v==="PH-EITHER"||v==="PH-SHOW"||v==="PH-SLOT"))c.setAttribute("value",f(` ${c.getAttribute("value")} `));if(v==="PH-DYNAMIC"&&c.hasAttribute("is"))c.setAttribute("is",f(` ${c.getAttribute("is")} `))}return i};class N extends p{mount(){this.style.display="contents";let s=this.firstElementChild;if(s?.tagName==="TEMPLATE")s.setAttribute("ph:each",this.getAttribute("ph:each")),N.fromTemplate(s);else throw Error("no template element provided")}static fromTemplate(s){w(s.content),s.before(document.createComment("ph-for begin")),s.after(document.createComment("ph-for end"));let o=s.getAttribute("ph:each"),r=s.previousSibling,t=s.nextSibling,n=s.getRootNode(),i=(n.host??n)[u],[e,f]=o?.split(" in ")??[],[a,A]=e.split(",").map((x)=>x.trim());if(i&&a&&f&&s){let x=y(i,f),c=0;g(()=>{let v=x.value.length;if(v!==c){if(v>c){let m=c;x.value.slice(m).forEach((D,P)=>{let T=s.content.firstElementChild.cloneNode(!0),S=Ws(T,f,a,P+m,A);t.before(S),S.disposes=[...H(S,i),...M(S,i)]})}else{let m=[],D=r.nextSibling,P=0;while(D&&D!==t){if(P>=v)m.push(D);P++,D=D.nextSibling}for(let T of m)T.disposes?.forEach((S)=>S()),T.remove?.()}c=x.value.length}})}s.remove()}}var os=Symbol("ready");class rs extends p{#s=this.attachShadow({mode:"open"});#o=new $;get[u](){return this.#o}async mount(){this.#o[O](os,new Promise(async(s)=>{this.style.display="none";let o=this.getAttribute("name"),r=this.querySelector("template"),t=r.cloneNode(!0).content,n=[];document[u][`$${o}`]=this[u];let i;for(let e of t.querySelectorAll("script")){if(e.setAttribute("type","javascript/blocked"),e.hasAttribute("init"))i=E(this[u],e.textContent);if(e.hasAttribute("watch"))n.push(E(this[u],e.textContent));if(e.parentElement?.tagName!=="PH-METHOD")e.remove()}this.#s.append(t),await ts(t,this[u]),await i?.(),Object.seal(this[u]);for(let e of n)g(()=>{e()});s(!0)}))}}var $s=(s,o)=>{let r=void 0,t=[];s.querySelectorAll("slot").forEach((n)=>{if(n.hasAttribute("name"))t.push(n);else r??=n});for(let n of t){let i=n.getAttribute("name");o[z](i)}s.onslotchange=()=>{o.slots.default=r?.assignedElements()??[];for(let n of t){let i=n.getAttribute("name");if(o.slots)o.slots[i]=n.assignedElements()}}},Ms=(s,o)=>{for(let r of s.querySelectorAll("[ph\\:ref]")){let t=r.getAttribute("ph:ref");o[O](t,r),r.removeAttribute("ph:ref")}},Ps=(()=>{let s=null;return()=>{if(s===null)s=document.querySelector("style[global]");return s}})(),_s=(s,o=!1)=>{let r=s.querySelector("style"),t=new CSSStyleSheet,n=new CSSStyleSheet,i=new CSSStyleSheet;if(!r?.hasAttribute("isolated"))t.replaceSync(Ps()?.innerHTML??"");n.replaceSync(`:host { display: ${o?"inline-block":"block"}; ${o?"position: relative":""} }`),i.replaceSync(r?.textContent??""),r?.remove(),s.adoptedStyleSheets.push(t,n,i)},ks=(s,o)=>{let r=o.template,t=o.attributes??[],n=o.properties??[];if(!s)throw Error("no tag attribute was provided");let i=class extends p{#s;#o=[];#r;#t;get[u](){return this.#t}static observedAttributes=t;attributeChangedCallback(e,f,a){let A=L(e);if(this[u]&&f!==a)this[u][A]=a}constructor(){super();let e=o.closedShadowRoot?"closed":"open";if(this.#s=this.attachShadow({mode:e}),!this[u])this.#t=new $,Object.setPrototypeOf(this[u],document[u]),this[u][O]("self",this),this[u][O]("root",this.#s);for(let f of n)if(f)this[u][q](f,k(void 0))}async mount(){for(let T of t)if(T){let S=L(T);this[u][q](S,k(this.getAttribute(T))),this.#o.push(g(()=>{let K=this[u][S];if(K!==void 0&&K!==null)this.setAttribute(T,K);else this.removeAttribute(T)}))}let e=r.cloneNode(!0).content,f=e.querySelector("script[on-mount]"),a=e.querySelector("script[on-remove]"),A=e.querySelectorAll("script[watch]"),x=f?E(this[u],f.textContent):void 0,c=a?E(this[u],a.textContent):void 0,v=Array.from(A).map((T)=>{let S=E(this[u],T.textContent);return T.remove(),S});this.#r=c,f?.remove(),a?.remove(),w(e),us(e),Ms(e,this[u]);let m=o.stores?.map((T)=>document[u][`$${T}`][os]);await Promise.all(m),o.stores.forEach((T)=>{this[u][O](T,document[u][`$${T}`])});let D=this.#s;D.append(e),$s(this.#s,this[u]),ns(D),await ts(D,this[u]),await x?.();let P=H(D,this[u]);this.#o.push(...P),Object.seal(this[u]);for(let T of v)this.#o.push(g(()=>{T()}));_s(D,o.inline)}unmount(){this.#r?.();for(let e of this.#o)e()}};d(s,i)},ns=(s)=>{for(let o of s.querySelectorAll("template[ph\\:each]"))N.fromTemplate(o)},us=(s)=>{let o=B(s);while(o.nextNode()){let r=o.currentNode;r.innerHTML=l(r.innerHTML)}},ts=async(s,o)=>{await Promise.all(Array.from(s.querySelectorAll("import[src]")).map(async(r)=>{let t=r.getAttribute("src"),n=t.includes(location.protocol)&&!(t.startsWith("/")||t.startsWith("./"))?t:`${location.origin}/${t}`,i=await import(n);for(let e of r.getAttributeNames()){let f=r.getAttribute(e)??e,a=i[L(e)];if(a)o[O](f,a)}r.remove();return}))};class fs extends p{mount(){let s=this.querySelector("template"),o=this.getAttribute("tag"),r=s.getAttribute("attributes")?.split(",")?.map((f)=>f.split(":")[0].trim()),t=s.getAttribute("properties")?.split(",")?.map((f)=>f.split(":")[0].trim()),n=s.hasAttribute("closed"),i=s.hasAttribute("inline"),e=s.getAttribute("use-stores")?.split(",")?.map((f)=>f.trim())??[];if(s?.tagName==="TEMPLATE")ks(o,{template:s,attributes:r,properties:t,inline:i,closedShadowRoot:n,stores:e});else throw Error("no template element provided")}}class es extends p{#s=[];#o;mount(){this.#o=this.childNodes,this.style.display="inline flow";let s=this.getAttribute("value"),o=this.getHost()?.[u];if(s&&o){let r=y(o,s);this.#s.push(...H(this,o)),this.#s.push(...M(this,o)),this.#s.push(g(()=>{if(r.value===!0)this.append(...this.#o);else this.#o=Array.from(this.childNodes).map((n)=>this.removeChild(n))}))}}unmount(){for(let s of this.#s)s()}}class is extends p{#s;mount(){this.style.display="inline flow";let s=this.getAttribute("value"),o=this.getHost()?.[u];if(s&&o){let r=y(o,s);this.#s=g(()=>{if(r.value)this.style.display="inline flow";else this.style.display="none"})}}unmount(){this.#s?.()}}class as extends p{#s=[];#o;#r;mount(){this.style.display="inline flow";let s=this.getAttribute("value"),o=this.getHost()?.[u];if(s&&o){this.#s.push(...H(this,o)),this.#s.push(...M(this,o));let[r,t]=this.children;this.#o=r,this.#r=t,this.innerHTML="";let n=y(o,s);this.#s.push(g(()=>{if(n.value){if(this.firstChild)this.#r=this.removeChild(this.firstChild);this.append(this.#o)}else{if(this.firstChild)this.#o=this.removeChild(this.firstChild);this.append(this.#r)}}))}}unmount(){for(let s of this.#s)s()}}class hs extends p{mount(){let s=this.getAttribute("is"),o=this.getHost()?.[u]??document[u],r=y(o,s);if(s&&o)g(()=>{setTimeout(()=>{this.replaceWith(r.value)})})}}class gs extends p{#s;mount(){setTimeout(()=>{this.style.display="contents";let s=this.getAttribute("value"),o=this.getHost()?.[u]??document[u];if(s&&o){let r=y(o,s);this.#s=g(()=>{this.textContent=r.value})}})}unmount(){this.#s?.()}}var Es=async()=>{console.group("ph init"),!document[u]&&Object.defineProperty(document,u,{value:new $,writable:!1}),d("ph-signal",R),d("ph-computed",I),d("ph-const",F),d("ph-method",V),d("ph-store",rs),d("ph-for",N),d("ph-either",as),d("ph-show",is),d("ph-if",es),d("ph-slot",gs),d("ph-dynamic",hs),d("ph-component",fs);let s=B(document.body);while(s.nextNode()){let o=s.currentNode;ss(o)}us(document.body),H(document.body,document[u]),ns(document.body),console.groupEnd()};window.ph={init:Es};})();
