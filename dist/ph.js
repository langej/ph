class p extends HTMLElement{#s=[];log(...s){let t=this.id?` #${this.id}`:"",o=this.getAttribute("name")?` :${this.getAttribute("name")}`:"";console.log(`[${this.tagName}${o}${t}]`,...s)}mount(){}unmount(){}connectedCallback(){this.mount()}disconnectedCallback(){this.unmount(),this.#s?.forEach((s)=>s()),this.#s=[]}on(s,t){return this.addEventListener(s,t)}getHost(){let s=this.getRootNode();return s.host??s}emit(s,t){let o=!t?new Event(s,{composed:!0}):new CustomEvent(s,{detail:t,composed:!0});this.dispatchEvent(o)}defer(s){this.#s.push(s)}}var Ss=Symbol.for("preact-signals");function Z(){if(!(P>1)){var s,t=!1;while(N!==void 0){var o=N;N=void 0,U++;while(o!==void 0){var r=o.o;if(o.o=void 0,o.f&=-3,!(8&o.f)&&ps(o))try{o.c()}catch(n){if(!t)s=n,t=!0}o=r}}if(U=0,P--,t)throw s}else P--}var c=void 0;var N=void 0,P=0,U=0,q=0;function gs(s){if(c!==void 0){var t=s.n;if(t===void 0||t.t!==c){if(t={i:0,S:s,p:c.s,n:void 0,t:c,e:void 0,x:void 0,r:t},c.s!==void 0)c.s.n=t;if(c.s=t,s.n=t,32&c.f)s.S(t);return t}else if(t.i===-1){if(t.i=0,t.n!==void 0){if(t.n.p=t.p,t.p!==void 0)t.p.n=t.n;t.p=c.s,t.n=void 0,c.s.n=t,c.s=t}return t}}}function m(s){this.v=s,this.i=0,this.n=void 0,this.t=void 0}m.prototype.brand=Ss;m.prototype.h=function(){return!0};m.prototype.S=function(s){if(this.t!==s&&s.e===void 0){if(s.x=this.t,this.t!==void 0)this.t.e=s;this.t=s}};m.prototype.U=function(s){if(this.t!==void 0){var{e:t,x:o}=s;if(t!==void 0)t.x=o,s.e=void 0;if(o!==void 0)o.e=t,s.x=void 0;if(s===this.t)this.t=o}};m.prototype.subscribe=function(s){var t=this;return h(function(){var o=t.value,r=c;c=void 0;try{s(o)}finally{c=r}})};m.prototype.valueOf=function(){return this.value};m.prototype.toString=function(){return this.value+""};m.prototype.toJSON=function(){return this.value};m.prototype.peek=function(){var s=c;c=void 0;try{return this.value}finally{c=s}};Object.defineProperty(m.prototype,"value",{get:function(){var s=gs(this);if(s!==void 0)s.i=this.i;return this.v},set:function(s){if(s!==this.v){if(U>100)throw Error("Cycle detected");this.v=s,this.i++,q++,P++;try{for(var t=this.t;t!==void 0;t=t.x)t.t.N()}finally{Z()}}}});function _(s){return new m(s)}function ps(s){for(var t=s.s;t!==void 0;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function ys(s){for(var t=s.s;t!==void 0;t=t.n){var o=t.S.n;if(o!==void 0)t.r=o;if(t.S.n=t,t.i=-1,t.n===void 0){s.s=t;break}}}function Ts(s){var t=s.s,o=void 0;while(t!==void 0){var r=t.p;if(t.i===-1){if(t.S.U(t),r!==void 0)r.n=t.n;if(t.n!==void 0)t.n.p=r}else o=t;if(t.S.n=t.r,t.r!==void 0)t.r=void 0;t=r}s.s=o}function k(s){m.call(this,void 0),this.x=s,this.s=void 0,this.g=q-1,this.f=4}(k.prototype=new m).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32)return!0;if(this.f&=-5,this.g===q)return!0;if(this.g=q,this.f|=1,this.i>0&&!ps(this))return this.f&=-2,!0;var s=c;try{ys(this),c=this;var t=this.x();if(16&this.f||this.v!==t||this.i===0)this.v=t,this.f&=-17,this.i++}catch(o){this.v=o,this.f|=16,this.i++}return c=s,Ts(this),this.f&=-2,!0};k.prototype.S=function(s){if(this.t===void 0){this.f|=36;for(var t=this.s;t!==void 0;t=t.n)t.S.S(t)}m.prototype.S.call(this,s)};k.prototype.U=function(s){if(this.t!==void 0){if(m.prototype.U.call(this,s),this.t===void 0){this.f&=-33;for(var t=this.s;t!==void 0;t=t.n)t.S.U(t)}}};k.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var s=this.t;s!==void 0;s=s.x)s.t.N()}};Object.defineProperty(k.prototype,"value",{get:function(){if(1&this.f)throw Error("Cycle detected");var s=gs(this);if(this.h(),s!==void 0)s.i=this.i;if(16&this.f)throw this.v;return this.v}});function As(s){return new k(s)}function vs(s){var t=s.u;if(s.u=void 0,typeof t=="function"){P++;var o=c;c=void 0;try{t()}catch(r){throw s.f&=-2,s.f|=8,w(s),r}finally{c=o,Z()}}}function w(s){for(var t=s.s;t!==void 0;t=t.n)t.S.U(t);s.x=void 0,s.s=void 0,vs(s)}function Ds(s){if(c!==this)throw Error("Out-of-order effect");if(Ts(this),c=s,this.f&=-2,8&this.f)w(this);Z()}function X(s){this.x=s,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}X.prototype.c=function(){var s=this.S();try{if(8&this.f)return;if(this.x===void 0)return;var t=this.x();if(typeof t=="function")this.u=t}finally{s()}};X.prototype.S=function(){if(1&this.f)throw Error("Cycle detected");this.f|=1,this.f&=-9,vs(this),ys(this),P++;var s=c;return c=this,Ds.bind(this,s)};X.prototype.N=function(){if(!(2&this.f))this.f|=2,this.o=N,N=this};X.prototype.d=function(){if(this.f|=8,!(1&this.f))w(this)};function h(s){var t=new X(s);try{t.c()}catch(o){throw t.d(),o}return t.d.bind(t)}var Es=(s,t)=>s.replace(/{{[^{}]*}}/g,(o)=>t(o.replace(/[{}]/g,""))),Cs=document.createTreeWalker.bind(document),d=(s,t)=>!customElements.get(s)&&customElements.define(s,t),j=(s)=>s.replace(/-[a-z]/g,(t)=>t[1].toUpperCase()),J=(s,t)=>{return Es(s,(o)=>{let r=o.replace(/[{}]/g," ");if(t)r=t(r);return`<ph-slot value="${r}"></ph-slot>`})},T=(s,t)=>{return Function("context","computed",`with(context){return computed(() => ${t})}`)(s,As)},D=(s,t,o="")=>{let r=t??"",n=t?.includes("await");return Function("context",`return ${n?"async":""} function(${o}){with (context) {${r}}}`)(s)},L=(s)=>{return Cs(s,NodeFilter.SHOW_ELEMENT,(t)=>t.tagName!=="TEMPLATE"?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT)},G=(s,t)=>{return Cs(s,NodeFilter.SHOW_ELEMENT,t)};var bs=({value:s,context:t})=>{try{return D(t,`return ${s}`)()}catch(o){console.error(o)}},Y=(s)=>{let t=s.getHost()?.[u]??document[u],o=s.getAttribute("name"),r=s.getAttribute("value");return{context:t,name:o,value:r}},u=Symbol(),l=Symbol(),ms=Symbol(),ds=Symbol(),O=Symbol(),z=Symbol();class W{slots={};constructor(){this[z]("default")}[z](s){let t=_([]);Object.defineProperty(this.slots,s,{get(){return t.value},set(o){t.value=o}})}[l](s,t){Object.defineProperty(this,s,{get(){return t.value},set(o){t.value=o}})}[ms](s,t){Object.defineProperty(this,s,{get(){return t.value}})}[ds](s,t){Object.defineProperty(this,s,{value:t})}[O](s,t){Object.defineProperty(this,s,{value:t,writable:!1})}}class R extends p{#s(s,t,o){if(s!==null){let r=s?s+"/":"",n=r+t,f=localStorage.getItem(n);if(f)o[t]=JSON.parse(f);h(()=>{localStorage.setItem(n,JSON.stringify(o[t]))})}}mount(){let{name:s,value:t,context:o}=Y(this);if(s&&t&&o){let r=bs({value:t,context:o}),n=this.getAttribute("local-storage");o[l](s,_(r)),this.#s(n,s,o)}this.remove()}}class I extends p{mount(){let{name:s,value:t,context:o}=Y(this);if(s&&t&&o){let r=T(o,t);o[ms](s,r)}this.remove()}}class F extends p{mount(){let{name:s,value:t,context:o}=Y(this);if(s&&t&&o){let r=bs({value:t,context:o});o[O](s,r)}this.remove()}}class V extends p{mount(){this.style.display="none";let{context:s,name:t}=Y(this),o=this.querySelector("script"),r=o?.textContent.trim()??"",n=o?.getAttribute("args")?.split(",")?.map((e)=>{let[a,i]=e.split(":").map((v)=>v.trim());return{name:a,type:i}}),f=n?.map((e)=>e.name).join(",");if(s&&r){let e=D(s,r,f);s[ds](t,e)}else{if(!s)this.log("no context provided!");if(!r)this.log("no body provided!")}this.remove()}}var C={"bind:":"bind:","bool:":"bool:","on:":"on:","prop:":"prop:","ph:":"ph:"},xs={"@":(s)=>s.replace("@",C["on:"]),".":(s)=>s.replace(".",C["prop:"]),"?":(s)=>s.replace("?",C["bool:"]),":":(s)=>s.replace(":",C["bind:"]),"*":(s)=>s.replace("*",C["ph:"])},K=(s)=>{let t=G(s);while(t.nextNode())ss(t.currentNode)},H=(s,t)=>{let o=[],r=L(s);while(r.nextNode()){let n=r.currentNode;o.push(...$(n,t))}return o},ss=(s)=>{for(let t of s.getAttributeNames()){let o=t,r=xs[o[0]]?.(o);if(r)s.setAttribute(r,s.getAttribute(o)),s.removeAttribute(o)}},$=(s,t)=>{let o=[],r=s.getAttributeNames();for(let n of r){let f=s.getAttribute(n);if(f&&f!==""){if(n.startsWith(C["on:"])){let a=n.replace(C["on:"],""),i=D(t,f,"$e");setTimeout(()=>{s.addEventListener(a,i)}),s.removeAttribute(n)}if(n.startsWith(C["bind:"])){let a=T(t,f),i=n.replace(C["bind:"],"");o.push(h(()=>{if(a.value!==void 0&&a.value!==null)s.setAttribute(i,a.value);else s.removeAttribute(i)})),s.removeAttribute(n)}if(n.startsWith(C["prop:"])){let a=j(n.replace(C["prop:"],"")),i=T(t,f);o.push(h(()=>{let v=s[u]??s;if(v[a]!==i.value)v[a]=i.value})),s.removeAttribute(n)}if(n.startsWith(C["bool:"])){let a=n.replace(C["bool:"],""),i=T(t,f);o.push(h(()=>{if(i.value)s.toggleAttribute(a,!0);else s.toggleAttribute(a,!1)})),s.removeAttribute(n)}if(n.startsWith(C["ph:"])){let a=n.replace(C["ph:"],"");if(a==="if"){let i=T(t,f),v=document.createComment("ph-if");s.before(v),setTimeout(()=>{o.push(h(()=>{if(i.value)v.after(s);else s.remove()}))})}else if(a==="show"){let i=T(t,f),v=s.style.display;o.push(h(()=>{if(i.value)s.style.display=v;else s.style.display="none"}))}s.removeAttribute(n)}}}return o};var Os=(s,t,o,r,n)=>{let f=s,e=(g)=>new RegExp(`([^a-zA-Z0-9$_]${g}[^a-zA-Z0-9$_:])`,"g"),a=(g)=>{let A=g.replace(e(o),(b)=>`${b[0]}${t}[${r}]?.valueOf()${b.at(-1)}`);if(n)return A.replace(e(n),(b)=>`${b[0]}${r}${b.at(-1)}`);return A},i=(g)=>{for(let A of g.getAttributeNames())if(Object.keys(C).some((b)=>A.startsWith(b)))g.setAttribute(A,a(` ${g.getAttribute(A)} `))},v=J(f.innerHTML,a);f.innerHTML=v,i(f);let x=G(f);while(x.nextNode()){let g=x.currentNode,A=g.tagName;if(i(g),g.hasAttribute("value")&&(A==="PH-IF"||A==="PH-EITHER"||A==="PH-SHOW"||A==="PH-SLOT"))g.setAttribute("value",a(` ${g.getAttribute("value")} `));if(A==="PH-DYNAMIC"&&g.hasAttribute("is"))g.setAttribute("is",a(` ${g.getAttribute("is")} `))}return f};class B extends p{mount(){this.style.display="contents";let s=this.firstElementChild;if(s?.tagName==="TEMPLATE")s.setAttribute("ph:each",this.getAttribute("ph:each")),B.fromTemplate(s);else throw Error("no template element provided")}static fromTemplate(s){K(s.content),s.before(document.createComment("ph-for begin")),s.after(document.createComment("ph-for end"));let t=s.getAttribute("ph:each"),o=s.previousSibling,r=s.nextSibling,n=s.getRootNode(),f=(n.host??n)[u],[e,a]=t?.split(" in ")??[],[i,v]=e.split(",").map((x)=>x.trim());if(f&&i&&a&&s){let x=T(f,a),g=0;h(()=>{let A=x.value.length;if(A!==g){if(A>g){let b=g;x.value.slice(b).forEach((S,M)=>{let y=s.content.firstElementChild.cloneNode(!0),E=Os(y,a,i,M+b,v);r.before(E),E.disposes=[...H(E,f),...$(E,f)]})}else{let b=[],S=o.nextSibling,M=0;while(S&&S!==r){if(M>=A)b.push(S);M++,S=S.nextSibling}for(let y of b)y.disposes?.forEach((E)=>E()),y.remove?.()}g=x.value.length}})}s.remove()}}var ts=Symbol("ready");class os extends p{#s=this.attachShadow({mode:"open"});#t=new W;get[u](){return this.#t}async mount(){this.#t[O](ts,new Promise(async(s)=>{this.style.display="none";let t=this.getAttribute("name"),o=this.querySelector("template"),r=o.cloneNode(!0).content,n=[];document[u][`$${t}`]=this[u];let f;for(let e of r.querySelectorAll("script")){if(e.setAttribute("type","javascript/blocked"),e.hasAttribute("init"))f=D(this[u],e.textContent);if(e.hasAttribute("watch"))n.push(D(this[u],e.textContent));if(e.parentElement?.tagName!=="PH-METHOD")e.remove()}this.#s.append(r),await rs(r,this[u]),await f?.(),Object.seal(this[u]);for(let e of n)h(()=>{e()});s(!0)}))}}var Hs=(s,t)=>{let o=s.querySelectorAll("slot").values(),r=o.find((f)=>!f.hasAttribute("name")),n=Array.from(o.filter((f)=>f.hasAttribute("name")));for(let f of n){let e=f.getAttribute("name");t[z](e)}s.onslotchange=()=>{t.slots.default=r?.assignedElements();for(let f of n){let e=f.getAttribute("name");if(t.slots)t.slots[e]=f.assignedElements()}}},Ws=(s,t)=>{for(let o of s.querySelectorAll("[ph\\:ref]")){let r=o.getAttribute("ph:ref");t[O](r,o),o.removeAttribute("ph:ref")}},$s=(()=>{let s=null;return()=>{if(s===null)s=document.querySelector("style[global]");return s}})(),Ms=(s,t=!1)=>{let o=s.querySelector("style"),r=new CSSStyleSheet,n=new CSSStyleSheet,f=new CSSStyleSheet;if(!o?.hasAttribute("isolated"))r.replaceSync($s()?.innerHTML??"");n.replaceSync(`:host { display: ${t?"inline-block":"block"}; ${t?"position: relative":""} }`),f.replaceSync(o?.textContent??""),o?.remove(),s.adoptedStyleSheets.push(r,n,f)},Ps=(s,t)=>{let o=t.template,r=t.attributes??[],n=t.properties??[];if(!s)throw Error("no tag attribute was provided");let f=class extends p{#s;#t=[];#o;#r;get[u](){return this.#r}static observedAttributes=r;attributeChangedCallback(e,a,i){let v=j(e);if(this[u]&&a!==i)this[u][v]=i}constructor(){super();let e=t.closedShadowRoot?"closed":"open";if(this.#s=this.attachShadow({mode:e}),!this[u])this.#r=new W,Object.setPrototypeOf(this[u],document[u]),this[u][O]("self",this),this[u][O]("root",this.#s);for(let a of n)if(a)this[u][l](a,_(void 0))}async mount(){for(let y of r)if(y){let E=j(y);this[u][l](E,_(this.getAttribute(y))),this.#t.push(h(()=>{let Q=this[u][E];if(Q!==void 0&&Q!==null)this.setAttribute(y,Q);else this.removeAttribute(y)}))}let e=o.cloneNode(!0).content,a=e.querySelector("script[on-mount]"),i=e.querySelector("script[on-remove]"),v=e.querySelectorAll("script[watch]"),x=a?D(this[u],a.textContent):void 0,g=i?D(this[u],i.textContent):void 0,A=Array.from(v).map((y)=>{let E=D(this[u],y.textContent);return y.remove(),E});this.#o=g,a?.remove(),i?.remove(),K(e),us(e),Ws(e,this[u]);let b=t.stores?.map((y)=>document[u][`$${y}`][ts]);await Promise.all(b),t.stores.forEach((y)=>{this[u][O](y,document[u][`$${y}`])});let S=this.#s;S.append(e),Hs(this.#s,this[u]),ns(S),await rs(S,this[u]),await x?.();let M=H(S,this[u]);this.#t.push(...M),Object.seal(this[u]);for(let y of A)this.#t.push(h(()=>{y()}));Ms(S,t.inline)}unmount(){this.#o?.();for(let e of this.#t)e()}};d(s,f)},ns=(s)=>{for(let t of s.querySelectorAll("template[ph\\:each]"))B.fromTemplate(t)},us=(s)=>{let t=L(s);while(t.nextNode()){let o=t.currentNode;o.innerHTML=J(o.innerHTML)}},rs=async(s,t)=>{await Promise.all(Array.from(s.querySelectorAll("import[src]")).map(async(o)=>{let r=o.getAttribute("src"),n=r.includes(location.protocol)&&!(r.startsWith("/")||r.startsWith("./"))?r:`${location.origin}/${r}`,f=await import(n);for(let e of o.getAttributeNames()){let a=o.getAttribute(e)??e,i=f[j(e)];if(i)t[O](a,i)}o.remove();return}))};class fs extends p{mount(){let s=this.querySelector("template"),t=this.getAttribute("tag"),o=s.getAttribute("attributes")?.split(",")?.map((a)=>a.split(":")[0].trim()),r=s.getAttribute("properties")?.split(",")?.map((a)=>a.split(":")[0].trim()),n=s.hasAttribute("closed"),f=s.hasAttribute("inline"),e=s.getAttribute("use-stores")?.split(",")?.map((a)=>a.trim())??[];if(s?.tagName==="TEMPLATE")Ps(t,{template:s,attributes:o,properties:r,inline:f,closedShadowRoot:n,stores:e});else throw Error("no template element provided")}}class es extends p{#s=[];#t;mount(){this.#t=this.childNodes,this.style.display="inline flow";let s=this.getAttribute("value"),t=this.getHost()?.[u];if(s&&t){let o=T(t,s);this.#s.push(...H(this,t)),this.#s.push(...$(this,t)),this.#s.push(h(()=>{if(o.value===!0)this.append(...this.#t);else this.#t=Array.from(this.childNodes).map((n)=>this.removeChild(n))}))}}unmount(){for(let s of this.#s)s()}}class as extends p{#s;mount(){this.style.display="inline flow";let s=this.getAttribute("value"),t=this.getHost()?.[u];if(s&&t){let o=T(t,s);this.#s=h(()=>{if(o.value)this.style.display="inline flow";else this.style.display="none"})}}unmount(){this.#s?.()}}class is extends p{#s=[];#t;#o;mount(){this.style.display="inline flow";let s=this.getAttribute("value"),t=this.getHost()?.[u];if(s&&t){this.#s.push(...H(this,t)),this.#s.push(...$(this,t));let[o,r]=this.children;this.#t=o,this.#o=r,this.innerHTML="";let n=T(t,s);this.#s.push(h(()=>{if(n.value){if(this.firstChild)this.#o=this.removeChild(this.firstChild);this.append(this.#t)}else{if(this.firstChild)this.#t=this.removeChild(this.firstChild);this.append(this.#o)}}))}}unmount(){for(let s of this.#s)s()}}class cs extends p{mount(){let s=this.getAttribute("is"),t=this.getHost()?.[u]??document[u],o=T(t,s);if(s&&t)h(()=>{setTimeout(()=>{this.replaceWith(o.value)})})}}class hs extends p{#s;mount(){setTimeout(()=>{this.style.display="contents";let s=this.getAttribute("value"),t=this.getHost()?.[u]??document[u];if(s&&t){let o=T(t,s);this.#s=h(()=>{this.textContent=o.value})}})}unmount(){this.#s?.()}}var _s=async()=>{console.group("ph init"),!document[u]&&Object.defineProperty(document,u,{value:new W,writable:!1}),d("ph-signal",R),d("ph-computed",I),d("ph-const",F),d("ph-method",V),d("ph-store",os),d("ph-for",B),d("ph-either",is),d("ph-show",as),d("ph-if",es),d("ph-slot",hs),d("ph-dynamic",cs),d("ph-component",fs);let s=L(document.body);while(s.nextNode()){let t=s.currentNode;ss(t)}us(document.body),H(document.body,document[u]),ns(document.body),console.groupEnd()};window.ph=_s;
